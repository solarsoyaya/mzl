<template>
  <div class="flex flex-col items-center space-y-8">
    <!-- 欢迎标题 -->
    <div class="text-center">
      <h1 class="text-4xl font-semibold text-gray-900 mb-2">莫智乐</h1>
      <p class="text-lg text-gray-600">您好！我是美智同学，有什么可以帮您的吗？</p>
    </div>

    <!-- 快捷指令卡片 -->
    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 w-full max-w-4xl">
      <div
        v-for="command in displayedCommands"
        :key="command.id"
        @click="handleCommandClick(command)"
        class="group cursor-pointer bg-white rounded-xl border border-gray-200 hover:border-gray-300 hover:shadow-md transition-all duration-200 p-6"
      >
        <div class="flex items-start space-x-4">
          <!-- 图标 -->
          <div class="flex-shrink-0">
            <div class="w-10 h-10 rounded-lg bg-gradient-to-br from-blue-500 to-blue-600 flex items-center justify-center">
              <span class="text-white text-lg">{{ command.icon }}</span>
            </div>
          </div>
          
          <!-- 内容 -->
          <div class="flex-1 min-w-0">
            <h3 class="text-base font-medium text-gray-900 group-hover:text-blue-600 transition-colors">
              {{ command.title }}
            </h3>
            <p class="text-sm text-gray-600 mt-1 line-clamp-2">
              {{ command.description }}
            </p>
          </div>
        </div>
      </div>
    </div>

    <!-- 刷新按钮 -->
    <button
      @click="refreshCommands"
      class="flex items-center space-x-2 px-4 py-2 text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded-lg transition-all duration-200"
    >
      <svg 
        :class="['w-4 h-4', isRefreshing ? 'animate-spin' : '']" 
        fill="none" 
        stroke="currentColor" 
        viewBox="0 0 24 24"
      >
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
      </svg>
      <span class="text-sm">换一批</span>
    </button>
  </div>
</template>

<script>
import { ref, onMounted } from 'vue'

export default {
  name: 'FloatingCommands',
  emits: ['command-click'],
  setup(props, { emit }) {
    const displayedCommands = ref([])
    const isRefreshing = ref(false)

    // 所有可用的快捷指令
    const allCommands = [
      {
        id: 1,
        icon: '🔧',
        title: '设备保养计划',
        description: '制定和管理医疗设备的定期保养计划，确保设备正常运行',
        content: `**医疗设备保养计划**

**常见设备保养周期：**

**1. 空调系统**
- 每月：清洁过滤网、检查制冷剂压力
- 每季度：清洗冷凝器、检查电气连接
- 每年：更换过滤器、全面系统检查

**2. 电梯设备**
- 每周：制动系统检查、通讯测试
- 每月：导轨润滑、安全装置测试
- 每年：钢丝绳更换、全面安全检查

**3. 供氧设备**
- 每日：压力检查、管路检查、安全阀测试
- 每周：备用系统切换测试
- 每月：管道密封性检查

**4. 医疗设备**
- 每日：外观检查、功能测试
- 每周：校准检查、清洁消毒
- 每月：深度维护、配件更换

**保养记录要求：**
- 详细记录保养时间、内容、发现问题
- 保养人员签字确认
- 建立设备档案，跟踪保养历史`
      },
      {
        id: 2,
        icon: '🚨',
        title: '应急事件处理',
        description: '快速响应医院突发事件，提供应急处理指导和联系方式',
        content: `**医院应急事件处理流程**

**常见应急事件及处理方法：**

**1. 设备故障应急**
- 立即切断电源，确保安全
- 启用备用设备或系统
- 通知工程部：134****0214（李经理）
- 联系维保单位进行抢修

**2. 停电应急**
- 启动应急发电机
- 优先保障重要科室供电
- 通知各科室做好应急准备
- 联系供电部门：95598

**3. 漏水应急**
- 关闭相关阀门，控制漏水范围
- 使用接水盘、围挡保护设备
- 疏散影响区域人员
- 联系维修人员：123****4215

**4. 火灾应急**
- 立即报警：119
- 启动消防系统
- 组织人员疏散
- 配合消防部门救援

**紧急联系电话：**
- 医院总值班：0571-88888888
- 工程经理：134****0214
- 24小时值班：135****3415`
      },
      {
        id: 3,
        icon: '📊',
        title: '设备故障排查',
        description: '诊断设备故障原因，提供维修建议和技术支持',
        content: `**设备故障排查指南**

**电气设备故障排查：**

**1. 空开跳闸**
- 检查线路绝缘电阻
- 测量负载电流是否过大
- 检查接地系统是否正常
- 确认空开规格是否匹配

**2. 电机不转**
- 检查电源电压是否正常
- 测量电机绕组电阻
- 检查启动电容是否损坏
- 确认机械部分是否卡死

**3. 人机界面故障**
- 检查24V电源输出电压
- 确认通讯线连接是否牢固
- 验证通讯参数设置
- 重启设备尝试恢复

**机械设备故障排查：**

**1. 水泵不出水**
- 检查进水阀门是否开启
- 确认水泵叶轮是否堵塞
- 检查管道是否有漏气
- 测量电机运行电流

**2. 空调不制冷**
- 检查制冷剂压力
- 清洁冷凝器和蒸发器
- 检查压缩机运行状态
- 确认温控器设置

**排查工具：**
万用表、钳形电流表、绝缘摇表、压力表`
      },
      {
        id: 5,
        icon: '📞',
        title: '紧急联系查询',
        description: '快速查找各科室和相关部门的紧急联系电话',
        content: `**医院紧急联系电话大全**

**院内紧急联系：**
🏥 **医院总值班：** 0571-88888888
🚑 **急诊科：** 0571-88888801
🔒 **保卫科：** 0571-88888889
⚕️ **医务科：** 0571-88888891
🏢 **院办：** 0571-88888892
👩‍⚕️ **护理部：** 0571-88888890

**工程维修联系：**
🔧 **工程经理：** 李经理 - 134****0214
🔧 **工程主管：** 王主管 - 142****4211
🔧 **工程技工：** 陈师傅 - 123****4215（白班）
🔧 **工程技工：** 吴师傅 - 134****0214（白班）

**外部维保单位：**
⚡ **电梯维保：** 0571-12345678
❄️ **空调维保：** 0571-12345679
🔌 **电气维保：** 0571-12345680
💧 **给排水维保：** 0571-12345681

**24小时值班：**
👮 **值班秩序员：** 陈保安 - 135****3415
📞 **项目经理：** 张主任 - 138****4215

**使用说明：**
- 紧急情况请直接拨打相应电话
- 非紧急事项请通过正常渠道联系
- 夜间和节假日请联系值班人员`
      },
      {
        id: 6,
        icon: '🏥',
        title: '患者投诉处理',
        description: '规范化处理患者投诉，提供标准流程和话术指导',
        content: `**患者投诉处理标准流程**

**处理原则：**
- 先安抚患者情绪、稳控场面
- 不主动归责、不承诺赔偿
- 明确告知"需负责人调查后处理"
- 避免因不当表述引发责任争议

**标准处理步骤：**

**第一步：立即安抚（2分钟内）**
- 保持冷静，耐心倾听患者诉求
- 表达理解："我理解您的心情，我们会认真处理"
- 避免争辩和推诿

**第二步：详细记录（5分钟内）**
- 记录投诉时间、地点、当事人
- 详细记录事件经过和患者诉求
- 收集相关证据和证人信息

**第三步：上报处理（10分钟内）**
- 立即上报科室负责人和医务科
- 通知相关部门配合调查
- 启动投诉处理程序

**第四步：跟进反馈（24小时内）**
- 配合调查工作，提供真实信息
- 及时向患者反馈处理进展
- 做好后续沟通和解释工作

**标准话术：**
- "我们非常重视您的意见"
- "我会立即向上级汇报"
- "我们会认真调查，给您一个满意的答复"
- "请您留下联系方式，我们会及时回复"

**联系电话：**
📞 **医务科：** 0571-88888891
📞 **院办：** 0571-88888892`
      },
      {
        id: 7,
        icon: '🔍',
        title: '设备台账管理',
        description: '管理和维护医疗设备台账，跟踪设备状态和历史记录',
        content: `**设备台账管理规范**

**台账建立要求：**

**基本信息记录：**
- 设备名称、型号、规格
- 设备编号、生产厂家
- 购置日期、启用日期
- 安装位置、使用科室
- 设备价值、折旧情况

**运行状态记录：**
- 设备当前状态（正常/故障/停用）
- 运行时间统计
- 故障频次记录
- 维修历史档案

**保养维护记录：**
- 日常保养计划和执行情况
- 定期维护内容和周期
- 保养人员和时间记录
- 更换配件和耗材记录

**现有设备台账示例：**

**1. XXX主机（AC001）**
- 位置：综合楼七楼
- 状态：正常运行
- 保养周期：每月10日
- 负责人：张三
- 上次保养：2024-11-10
- 下次保养：2024-12-10

**2. 电梯A3（EL001）**
- 位置：住院楼A区
- 状态：正常运行
- 保养周期：每周巡检
- 负责人：李四
- 上次保养：2024-12-02
- 下次保养：2024-12-09

**3. 氧气站主机（OX001）**
- 位置：设备房
- 状态：正常运行
- 保养周期：每日巡检
- 负责人：王五
- 风险等级：高

**管理要求：**
- 每日更新设备状态
- 及时记录故障和维修
- 定期统计分析设备性能
- 建立设备档案，便于查询`
      },
      {
        id: 8,
        icon: '⚡',
        title: '能耗监控分析',
        description: '分析医院能耗数据，提供节能建议和优化方案',
        content: `**医院能耗监控分析报告**

**主要能耗设备及占比：**

**1. 空调系统（40-50%）**
- 中央空调主机：35%
- 新风系统：8%
- 末端设备：7%
- 节能建议：定期清洁、温度合理设置、变频控制

**2. 照明系统（15-20%）**
- 病房照明：10%
- 公共区域：6%
- 手术室：4%
- 节能建议：LED改造、智能控制、分时段管理

**3. 医疗设备（20-25%）**
- 大型检查设备：15%
- 手术设备：6%
- 监护设备：4%
- 节能建议：合理排班、待机管理、定期维护

**4. 电梯系统（5-8%）**
- 客梯：4%
- 货梯：2%
- 医用电梯：2%
- 节能建议：错峰运行、节能模式、定期保养

**5. 其他设备（10-15%）**
- 给排水系统：5%
- 通风系统：4%
- 信息系统：3%
- 消防系统：3%

**节能措施建议：**

**短期措施（1-3个月）：**
- 调整空调温度设定值（夏季26℃，冬季20℃）
- 优化照明开关时间
- 加强设备待机管理
- 提高员工节能意识

**中期措施（3-12个月）：**
- 安装变频控制系统
- 更换LED照明设备
- 优化设备运行时间
- 建立能耗监控系统

**长期措施（1-3年）：**
- 更新高效节能设备
- 建设智能控制系统
- 实施合同能源管理
- 开展能源审计

**预期节能效果：**
- 短期节能5-10%
- 中期节能15-25%
- 长期节能30-40%`
      },
      {
        id: 9,
        icon: '🛠️',
        title: '维修工单管理',
        description: '创建和跟踪设备维修工单，管理维修进度和质量',
        content: `**维修工单管理系统**

**工单创建流程：**

**1. 故障报告**
- 设备名称和编号
- 故障现象描述
- 影响范围评估
- 紧急程度分级
- 报告人信息

**2. 工单分派**
- 根据故障类型分派维修人员
- 设定维修时限
- 准备所需工具和配件
- 通知相关科室

**3. 维修执行**
- 现场勘查和故障确认
- 制定维修方案
- 实施维修作业
- 功能测试和验收

**4. 工单关闭**
- 填写维修记录
- 更新设备档案
- 用户确认签字
- 工单归档保存

**工单优先级分类：**

**紧急（2小时内）：**
- 影响生命安全的设备故障
- 手术室、ICU关键设备
- 全院性系统故障
- 消防安全设备故障

**重要（4小时内）：**
- 影响正常医疗的设备故障
- 病房空调、电梯故障
- 供水供电局部故障
- 信息系统故障

**一般（24小时内）：**
- 不影响正常运行的故障
- 办公设备故障
- 环境设施问题
- 预防性维修

**当前工单状态示例：**

**进行中工单：**
1. 综合楼七楼空调漏水 - 陈师傅处理中
2. 电梯A3通讯故障 - 联系维保公司
3. 氧气站压力异常 - 王五检查中

**今日完成工单：**
1. 手术室3空调维修 - 已完成
2. 病房照明更换 - 已完成
3. 污水泵保养 - 已完成

**维修质量要求：**
- 维修后设备功能完全恢复
- 无安全隐患
- 用户满意度≥95%
- 维修记录完整准确`
      },
      {
        id: 10,
        icon: '📈',
        title: '运营数据分析',
        description: '分析后勤运营数据，生成统计报表和趋势分析',
        content: `**后勤运营数据分析报告**

**设备运行数据统计：**

**设备完好率：**
- 本月设备完好率：96.5%
- 上月设备完好率：95.2%
- 同比提升：1.3%
- 目标完好率：≥95%

**故障处理统计：**
- 本月故障工单：45件
- 平均处理时间：2.3小时
- 及时处理率：98.9%
- 用户满意度：97.8%

**保养执行情况：**
- 计划保养项目：128项
- 完成保养项目：126项
- 保养完成率：98.4%
- 延期保养：2项

**能耗数据分析：**

**月度能耗对比：**
- 本月总用电：45.6万kWh
- 上月总用电：47.2万kWh
- 节约用电：1.6万kWh（3.4%）
- 节约费用：约8000元

**分项能耗占比：**
- 空调系统：45%（20.5万kWh）
- 照明系统：18%（8.2万kWh）
- 医疗设备：22%（10.0万kWh）
- 电梯系统：7%（3.2万kWh）
- 其他设备：8%（3.7万kWh）

**成本控制分析：**

**维修费用统计：**
- 本月维修费用：12.8万元
- 预算控制率：95.6%
- 主要支出：空调维修（4.2万）、电梯保养（3.1万）

**配件库存分析：**
- 库存总值：28.5万元
- 周转率：4.2次/年
- 积压配件：5.2万元
- 急需配件：8项

**人员效率分析：**

**工作量统计：**
- 人均工单处理：15.2件/月
- 人均巡检：45次/月
- 培训参与率：100%
- 技能考核通过率：98%

**趋势分析：**
- 设备老化趋势：3年内需更新15%设备
- 能耗下降趋势：预计年节能10%
- 维修成本上升：预计年增长5%
- 人员需求：建议增加2名技术人员

**改进建议：**
1. 加强预防性维护，降低故障率
2. 推进节能改造，控制能耗成本
3. 优化配件库存，减少资金占用
4. 提升人员技能，提高工作效率`
      },
      {
        id: 11,
        icon: '🔒',
        title: '安全检查指导',
        description: '提供医院安全检查清单和标准操作程序',
        content: `**医院安全检查标准清单**

**消防安全检查：**

**每日检查项目：**
- 消防通道是否畅通
- 安全出口指示灯是否正常
- 消防器材是否完好
- 消防控制室值班情况
- 重点部位防火措施

**每周检查项目：**
- 消防水系统压力测试
- 火灾报警系统功能测试
- 消防泵房设备检查
- 防火门闭门器检查
- 消防电梯功能测试

**每月检查项目：**
- 消防设施全面检查
- 消防演练组织实施
- 消防档案整理更新
- 重点部位深度检查
- 消防培训开展情况

**电气安全检查：**

**配电室检查：**
- 配电柜运行状态
- 电缆接头温度
- 绝缘工具完好性
- 安全警示标识
- 值班记录完整性

**用电设备检查：**
- 设备接地是否良好
- 电线电缆是否老化
- 漏电保护器是否正常
- 用电负荷是否超标
- 临时用电是否规范

**特种设备安全：**

**电梯安全检查：**
- 运行平稳性测试
- 安全装置功能测试
- 轿厢内通讯设备
- 机房环境检查
- 维保记录查验

**压力容器检查：**
- 压力表、安全阀检查
- 管道连接是否牢固
- 保温层是否完好
- 操作规程是否上墙
- 操作人员持证情况

**环境安全检查：**

**建筑结构安全：**
- 墙体是否有裂缝
- 屋面是否有渗漏
- 地面是否有沉降
- 门窗是否牢固
- 护栏高度是否符合要求

**环境卫生安全：**
- 垃圾分类处理情况
- 污水处理系统运行
- 空气质量监测
- 噪音控制措施
- 有害物质管理

**检查频次要求：**
- 重点部位：每日检查
- 一般区域：每周检查
- 全面检查：每月一次
- 专项检查：每季度一次
- 年度检查：委托第三方

**检查记录要求：**
- 检查时间、人员、部位
- 发现问题详细描述
- 整改措施和时限
- 复查结果确认
- 相关人员签字确认

**安全隐患分级：**
- 一级隐患：立即停用整改
- 二级隐患：24小时内整改
- 三级隐患：一周内整改
- 四级隐患：一月内整改`
      },
      {
        id: 12,
        icon: '💊',
        title: '物资库存管理',
        description: '管理医疗物资库存，提供采购建议和库存预警',
        content: `**医疗物资库存管理规范**

**库存分类管理：**

**A类物资（高价值）：**
- 大型设备配件
- 进口医疗器械
- 特殊药品试剂
- 管理要求：精确控制，每日盘点

**B类物资（中价值）：**
- 常用医疗器械
- 办公设备耗材
- 维修工具配件
- 管理要求：定期盘点，每周统计

**C类物资（低价值）：**
- 日常清洁用品
- 办公文具用品
- 一般维修材料
- 管理要求：简化管理，每月盘点

**库存控制标准：**

**安全库存设置：**
- 急救药品：30天用量
- 常用耗材：15天用量
- 维修配件：根据设备重要性
- 清洁用品：7天用量

**采购点设置：**
- 当库存降至安全库存时启动采购
- 紧急物资：双倍安全库存
- 季节性物资：提前2个月采购
- 特殊物资：建立供应商备选库

**现有库存状态：**

**医疗耗材库存：**
- 一次性注射器：库存充足（25天用量）
- 输液器：需要补充（8天用量）⚠️
- 纱布绷带：库存正常（18天用量）
- 消毒用品：库存充足（32天用量）

**设备配件库存：**
- 空调过滤网：库存不足（3套）⚠️
- 电梯配件：库存正常
- 水泵配件：需要采购（密封圈）⚠️
- 电气配件：库存充足

**清洁用品库存：**
- 消毒液：库存充足（45天用量）
- 清洁剂：库存正常（12天用量）
- 垃圾袋：需要补充（5天用量）⚠️
- 拖把抹布：库存正常

**采购建议：**

**紧急采购（3天内）：**
1. 输液器 - 1000套
2. 空调过滤网 - 20套
3. 垃圾袋 - 50箱
4. 水泵密封圈 - 10套

**计划采购（1周内）：**
1. 一次性手套 - 100箱
2. 清洁剂 - 20桶
3. 办公用纸 - 50箱
4. 维修工具 - 补充清单

**库存优化建议：**
1. 建立供应商评价体系
2. 实施JIT（准时制）采购
3. 加强库存周转率管理
4. 建立物资使用预测模型
5. 完善库存预警系统

**成本控制措施：**
- 集中采购降低成本
- 建立价格监控机制
- 优化库存结构
- 减少资金占用
- 防止物资浪费和过期`
      }
    ]

    // 随机选择3个指令显示
    const getRandomCommands = () => {
      const shuffled = [...allCommands].sort(() => 0.5 - Math.random())
      return shuffled.slice(0, 3)
    }

    // 刷新指令
    const refreshCommands = () => {
      isRefreshing.value = true
      
      setTimeout(() => {
        displayedCommands.value = getRandomCommands()
        isRefreshing.value = false
      }, 500)
    }

    // 处理指令点击
    const handleCommandClick = (command) => {
      emit('command-click', command)
    }

    // 组件挂载时初始化
    onMounted(() => {
      displayedCommands.value = getRandomCommands()
    })

    return {
      displayedCommands,
      isRefreshing,
      refreshCommands,
      handleCommandClick
    }
  }
}
</script>

<style scoped>
.line-clamp-2 {
  display: -webkit-box;
  -webkit-line-clamp: 2;
  -webkit-box-orient: vertical;
  overflow: hidden;
}
</style>